var X=Object.defineProperty;var D=(a,t,e)=>t in a?X(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var u=(a,t,e)=>(D(a,typeof t!="symbol"?t+"":t,e),e);import"./modulepreload-polyfill.b7f2da20.js";import{W as F,Z as V,S as Y,i as W,_ as A,$ as l,T as E,m as p,a as q,a0 as I,K as M,g as y,a1 as w,a2 as x,s as Q,b as P,Y as f,c,a3 as G,a4 as H,f as K,n as J}from"./vendor.23931e5f.js";class Z{constructor(t){this.container=t,this.renderer=new F({antialias:!0}),this.renderer.setSize(t.offsetWidth,t.offsetHeight,!1),this.renderer.setPixelRatio(window.devicePixelRatio),t.append(this.renderer.domElement),t.offsetWidth,t.offsetHeight,100*t.offsetWidth/t.offsetHeight,100*t.offsetWidth/t.offsetHeight;const e=t.offsetWidth/t.offsetHeight,s=1e3,i=s/e;this.camera=new V(s/-2,s/2,i/2,i/-2,0,1e3),this.scene=new Y,this.scene.add(this.camera),this.clock=new W,this.assets={},this.disposed=!1,this.tick=this.tick.bind(this),this.init=this.init.bind(this)}loadAssets(){return new Promise((t,e)=>{})}init(){this.tick()}getViewSizeAtDepth(t=0){const e=this.camera.fov*Math.PI/180,s=Math.abs((this.camera.position.z-t)*Math.tan(e/2)*2);return{width:s*this.camera.aspect,height:s}}dispose(){this.disposed=!0}onResize(){}update(){}render(){this.renderer.render(this.scene,this.camera)}tick(){if(this.disposed)return;if(_(this.renderer)){const e=this.renderer.domElement;this.camera.aspect=e.clientWidth/e.clientHeight,this.camera.updateProjectionMatrix(),this.onResize()}const t=this.clock.getDelta();this.render(t),this.update(t),requestAnimationFrame(this.tick)}}function _(a){const t=a.domElement,e=t.clientWidth,s=t.clientHeight,i=t.width!==e||t.height!==s;return i&&a.setSize(e,s,!1),i}var U="data:image/png;base64,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";const $=container.offsetWidth/container.offsetHeight,d=1e3,m=d/$;var tt="/playground1/assets/ball3.a882feb9.png",et="/playground1/assets/hit1.edfa9731.m4a",it="/playground1/assets/hit2.b10388c2.m4a",st="/playground1/assets/hit3.401d0d66.m4a",ot="/playground1/assets/hit4.18e89af6.m4a",at="/playground1/assets/hit5.3595b5da.m4a";const rt=(a,t)=>{var e=new CustomEvent(a,{bubbles:!0,detail:t});window.dispatchEvent(e)},nt=(a,t)=>{const e=ht(t);return window.addEventListener(a,e),{listener:e,off:()=>{lt(a,e)}}},lt=(a,t)=>{window.removeEventListener(a,t)},ht=a=>t=>{a(t.detail)};var ct="/playground1/assets/tap.a11eec6b.mp3",dt="/playground1/assets/music.8fa296fe.wav",mt="/playground1/assets/dark.a835debc.mp3";let j=.8,C=.3;var pt=[et,it,st,ot,at],ut=pt.map(a=>new A.Howl({src:a,volume:j,sprite:{__default:[100,1e3]}}));const ft=new A.Howl({src:ct,volume:j}),B=new A.Howl({src:dt,loop:!0,volume:C}),b=new A.Howl({src:mt,loop:!0,volume:C});b.volume(0);b.play();const L=(a,t,e)=>{l.to(a,{volume:0,duration:e}),l.to(t,{volume:C,duration:e})};let k=B;nt("bloodsugar:change",a=>{a.to=="low"&&(L(k,b,2),k=b),a.to=="normal"&&(L(k,B,2),k=B)});const R=a=>Array.isArray(a)?a[Math.floor(Math.random()*a.length)]:a,g=a=>{if(!!a)return a.removeFromParent(),a.geometry.dispose(),a.material.dispose(),a.geometry=null,a.material=null,a=null,null},O=new E;var vt=O.load(U);const gt=O.load(tt);class N{constructor(t){u(this,"ticks",0);this.app=t,this.vel=new p(1,1,0)}revive(){this.mesh.position.set(0,60,0),this.mesh.material.color.set(16777215)}dispose(){this.mesh=g(this.mesh),this.geometry=null,this.material=null,this.smoke2=g(this.smoke2)}hitBrick(t){this.mesh.material.color=t.mesh.material.uniforms.uColor.value.clone(),this.mesh.material.color.multiplyScalar(1),this.app.effects.showHit(t.mesh.position),l.fromTo(this.mesh.scale,{x:.5},{x:1,duration:.1})}init(){this.geometry=new q(10,32,32),this.material=new I({side:M,map:gt});var t=new y(this.geometry,this.material);t.position.y=60,t.position.x=0,t.position.z=0,this.mesh=t,this.power=1,this.config={curve:1};const e=new w({map:vt});this.smoke2=new x(e),this.app.scene.add(this.smoke2),this.app.scene.add(t)}setCurve(t){let e=1;(t>0&&this.vel.x>0||t<0&&this.vel.x<0)&&(e=2),e=t*2*((Math.random()+1)/2),console.log(t,e),l.timeline().to(this.config,{curve:e,duration:.4}).to(this.config,{curve:1,delay:1,duration:1})}bounce(){const t=Math.random()*20;this.smoke2.material.rotation=10*Math.random(),this.smoke2.position.copy(this.mesh.position),this.smoke2.position.z=5,ft.play(),l.fromTo(this.mesh.scale,{x:.2},{x:1,duration:.1}),l.timeline().fromTo(this.smoke2.scale,{x:0,y:0,z:0},{duration:.1,x:50-t,y:50-t,z:1}).fromTo(this.smoke2.material,{opacity:1},{duration:.2,opacity:0},0)}update(t){this.ticks++;let e=Math.min(3+t*.04,7);this.app.modifiers.isBloodSugarLow()?e=3:e=6-10/this.app.modifiers.bloodSugar;let s=this.vel,i=10/2,o=10/2,n=this.mesh.position.x,r=this.mesh.position.y;(n+i>d/2||this.mesh.position.x-i<-d/2)&&(s.reflect(new p(1,0,0)),this.bounce()),(r+o>m/2||r-o<-m/2)&&(s.reflect(new p(0,1,0)),this.bounce());let h=s.clone().multiplyScalar(e);this.mesh.rotateZ(.05),h.y-=this.config.curve,this.mesh.position.add(h),this.ticks%2==0&&this.app.effects.showClouds(1,this.mesh.position,50)}}class wt{init(){this.startDate=new Date}isBloodSugarLow(){if(this.bloodSugar<=4)return!0}isBloodSugarNormal(){if(this.bloodSugar>4&&this.bloodSugar<10)return!0}isBloodSugarHigh(){if(this.bloodSugar>=10)return!0}getBloodSugar(t){return Math.max(Math.cos(t*.1)*8.14+(1+Math.sin(t*.2))*7,2)}getBloodSugarString(){if(this.isBloodSugarLow())return"low";if(this.isBloodSugarNormal())return"normal";if(this.isBloodSugarHigh())return"high"}update(t){this.bloodSugar=this.getBloodSugar(t);const e=this.getBloodSugarString(),s=this.bloodSugarString;e!=s&&(rt("bloodsugar:change",{from:s,to:e}),this.bloodSugarString=e)}}const At=`
uniform vec3 uColor;
uniform float uAlpha;
varying vec3 vPositionW;
varying vec3 vNormalW;
varying vec3 normals;
varying vec2 vUv;
void main() {
	vec3 color = vec3(1., 1., 1.);
	vec3 viewDirectionW = normalize(cameraPosition - vPositionW);
	float fresnelTerm = dot(viewDirectionW, vNormalW);
	fresnelTerm = clamp(fresnelTerm,0.9, 2.0);

	color = uColor;
	

	// borders
	
	// if(vUv.x > .95) {
	// 	color = vec3(1., 0., 0.);
	// }

	// float b = step(vUv.x, 0.95);	
	// color *= b;
	// b = step(0.05, vUv.x);
	// color *= b;

	//color.r *= vUv.x ;
	//color.r *= vPositionW.x;
	//color.g *= vUv.y;

    gl_FragColor = vec4(color, uAlpha);
    //gl_FragColor = vec4(uColor, 1.0);
}
`,yt=`
varying vec3 vPositionW;
varying vec3 vNormalW;
varying vec2 vUv;

void main() {
    vUv = uv;
    vPositionW = vec3( vec4( position, 1.0 ) * modelMatrix);
    vNormalW = normalize( vec3( vec4( normal, 0.0 ) * modelMatrix ) );
    
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
`;var xt="/playground1/assets/ball1.1a2ffa70.png",Bt="/playground1/assets/ball2.466a70af.png";const T=new E,bt=T.load(xt),kt=T.load(Bt),St=["","#fbff80","#cc6cf5","#80c6ff","orange"];class Et{constructor(t,e,s,i,o,n){this.app=t,this.brickPoints=e,this.rows=s,this.columns=i,this.row=o,this.column=n}init(){const t=d/10,e=15,s=10;this.points=R(this.brickPoints),this.life=this.points,this.ability=this.getAbility(),this.reinit(),this.geometry=new Q(t-s,e,1),this.material=new P({fragmentShader:At,vertexShader:yt,uniforms:{uColor:new f(new c(this.config.color)),uAlpha:new f(1),uTime:new f(0)},transparent:!0,opacity:1,side:M});var i=new y(this.geometry,this.material);i.position.y=m/2-e/2-50,i.position.y-=e*(this.row+1)+10*this.row,i.position.x=-d/2+t*this.column,this.mesh=i,this.group=new G,this.group.add(i),this.applyAbility(),this.app.scene.add(this.group)}dispose(){this.mesh=g(this.mesh),this.geometry=null,this.material=null,this.meshEffect=g(this.meshEffect),this.group.removeFromParent()}applyAbility(){if(this.ability){let t="";this.ability==="bomb-column"?t=bt:this.ability==="extra-ball"&&(t=kt);const e=new w({map:t});this.meshEffect=new x(e),this.meshEffect.scale.set(40,40,10),this.meshEffect.position.copy(this.mesh.position),this.meshEffect.position.z=5,this.meshEffect.material.opacity=1,this.group.add(this.meshEffect)}else this.meshEffect&&(this.group.remove(this.meshEffect),this.meshEffect.material.dispose(),this.meshEffect.mater=null,this.meshEffect.geometry.dispose(),this.meshEffect.geometry=null,this.meshEffect=null)}reinit(){let t=St[this.points];this.config={opacity:1,color:t}}hit(t=1){this.life-=t,this.mesh.rotateZ(Math.random()*.2),R(ut).play(),this.isDead()&&this.destroy();const e=this.ability;return this.looseAbility(),{points:this.getPoints(),ability:e}}looseAbility(){this.ability=null,this.applyAbility()}getPoints(){if(this.isDead())return this.points}destroy(){this.app.effects.showExplosions(1,this.mesh.position),this.mesh.material.uniforms.uAlpha.value=0,l.to(this.config,{duration:.5,opacity:0})}isDead(){return this.life<1}isActive(){return this.life>0}allChildren(t){this.group.children.forEach(e=>{e instanceof H&&t(e)})}revive(){this.life=this.points,this.mesh.material.uniforms.uAlpha.value=1,this.mesh.rotation.z=0,this.ability=this.getAbility(),this.applyAbility(),this.config.opacity=1}getAbility(){return Math.random()<.9?null:R(["bomb-column","extra-ball"])}update(t){this.time=t,this.mesh.material.uniforms.uTime.value=t,this.allChildren(e=>{e.material instanceof w?e.material.opacity=this.config.opacity:e.material instanceof P&&e.material.uniforms.uPacity&&(e.material.uniforms.uOpacity.value=this.config.opacity)})}}const Pt=`
uniform vec3 uColor;
uniform float uAlpha;
uniform vec2 uResolution;
uniform float uTime;
varying vec3 vPositionW;
varying vec3 vNormalW;
varying vec2 vUv;

float dist(vec2 p0, vec2 pf){return sqrt((pf.x-p0.x)*(pf.x-p0.x)+(pf.y-p0.y)*(pf.y-p0.y));}

void main() {

    
			vec3 color = vec3(1., 1., 1.);
			vec3 viewDirectionW = normalize(cameraPosition - vPositionW);
			float fresnelTerm = .5 - dot(viewDirectionW, vNormalW);
			fresnelTerm = clamp(fresnelTerm,0.0, .9);

		vec2 sc = vPositionW.xy/uResolution;
		float c = clamp(sc.x, .9, 1.);
		float a = c;
		float circle = dist(uResolution*0.5, vPositionW.xy) * 0.002 + sin(uTime) * 0.1;
		float offset = .14 + sin(uTime * 2.) * 0.1;
        gl_FragColor = vec4( uColor, (circle - offset) * uAlpha);
    
	

    //gl_FragColor = vec4(uColor, 1.0);
}
`;class Ct{constructor(t){this.app=t}dispose(){g(this.mesh)}init(){var t=new K(d,m);const e=["varying vec3 vPositionW;","varying vec3 vNormalW;varying vec2 vUv;","void main() {"," vUv = uv;","	vPositionW = vec3( vec4( position, 1.0 ) * modelMatrix);"," vNormalW = normalize( vec3( vec4( normal, 0.0 ) * modelMatrix ) );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`);var s=new P({fragmentShader:Pt,vertexShader:e,transparent:!0,uniforms:{uReslution:new f(new J(d,m)),uColor:new f(new c("#000000")),uAlpha:new f(0),uTime:new f(0)}});this.mesh=new y(t,s),this.mesh.position.z=10,this.app.scene.add(this.mesh),this.isShown=!1}show(){this.isShown||(this.isShown=!0,l.to(this.mesh.material.uniforms.uAlpha,{duration:.5,value:.7}))}hide(){this.isShown&&(l.to(this.mesh.material.uniforms.uAlpha,{duration:.5,value:0}),this.isShown=!1)}update(t){this.mesh.material.uniforms.uTime.value=t}}class Rt{constructor(t){this.app=t,this.vel=new p(0,0,0)}dispose(){g(this.mesh)}init(){const t=5;var e=new Q(200,50,10),s=new I({color:new c("#56cc7d")}),i=new y(e,s);i.position.y=-m/2+t/2,i.position.x=0,this.mesh=i,this.app.scene.add(i);let o=[];const n=()=>{const r=o[0];r=="ArrowLeft"?this.vel.x=-1:r=="ArrowRight"?this.vel.x=1:this.vel.x=0};window.addEventListener("keydown",r=>{o.unshift(r.key),n()}),window.addEventListener("touchmove",r=>{console.log(r),r.touches[0].clientX}),window.addEventListener("keyup",r=>{o=o.filter(h=>h!==r.key),n()})}hit(){this.mesh.material.color.set(new c("lightBlue")),l.timeline().to(this.mesh.scale,{duration:.05,y:.3,ease:"expo.out",yoyo:!0,repeat:1}),l.fromTo(this.mesh.scale,{x:.5},{x:1,duration:.3})}update(t,e){let s=10,i=this.vel,o=200/2;this.mesh.position.x,e?(this.mesh.scale.x=.6,this.mesh.material.color=new c("#ff0000")):(this.mesh.scale.x=1,this.mesh.material.color=new c("#56cc7d"));let n=i.clone().multiplyScalar(s);this.mesh.position.add(n).clamp(new p(-d/2+o,-m),new p(d/2-o,m))}}var Wt="data:image/png;base64,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";const z=new E,It=z.load(Wt),Mt=z.load(U);class Qt{constructor(){u(this,"explosions",[]);u(this,"clouds",[]);u(this,"lastExplosion",0);u(this,"lastCloud",0)}init(t){this.app=t,console.warn("hello from effects"),this.setupExplosions(),this.setupClouds()}showClouds(t,e,s,i){i=i||c.white;for(let o=0;o<t;o++){const n=this.lastCloud++%this.clouds.length,r=this.clouds[n];r.position.copy(e),r.material.color.set(i),s=s||40,s+=s/2*Math.random(),l.fromTo(r.material,{opacity:1},{duration:.7,opacity:0}),l.to(r.material,{duration:1,rotation:Math.PI*Math.random()*Math.PI}),l.fromTo(r.scale,{x:0,y:0},{duration:1,x:s,y:s})}}setupClouds(){this.clouds=[];const t=50;let e=Mt;const s=new w({map:e});for(let i=0;i<t;i++){const o=new x(s.clone());o.scale.set(0,0,0),o.opacity=0,this.clouds.push(o),this.app.scene.add(o)}}setupExplosions(){this.explosions=[];const t=5;let e=It;const s=new w({map:e});for(let i=0;i<t;i++){const o=new x(s.clone());o.scale.set(0,0,0),o.opacity=0,this.explosions.push(o),this.app.scene.add(o)}}showHit(t){let e=t.clone();e.z=1,this.showExplosions(1,e,40,c.red)}showExplosions(t,e,s,i){i=i||c.white;for(let o=0;o<t;o++){const n=this.lastExplosion++%this.explosions.length,r=this.explosions[n];r.position.copy(e),r.material.color.set(i),s=s||40,s+=s/2*Math.random(),l.fromTo(r.material,{opacity:1},{duration:.7,opacity:0}),l.to(r.material,{duration:1,rotation:Math.PI*Math.random()*Math.PI}),l.fromTo(r.scale,{x:0,y:0},{duration:1,x:s,y:s})}}}class Ut extends Z{constructor(t){const e={container:document.getElementById("container")};super(e.container);u(this,"isBallAlignedWithBrick",t=>{const e=t.mesh.position.x,s=t.mesh.position.y;return this.bricks.filter(i=>i.isActive()).find(i=>{const o=i.mesh.position.x,n=i.mesh.geometry.parameters.width/2,r=i.mesh.position.y,h=i.mesh.geometry.parameters.height/2,v=e>o-n&&e<o+n,S=s<r+h&&s>r-h;return v&&S?i:!1})});this.options=e}initFirstOnly(){B.play(),document.addEventListener("keydown",t=>{t.keyCode==32&&(this.reset(),this.init())})}init(t){if(t&&this.initFirstOnly(),this.points=0,this.points_record=localStorage.getItem("points_record"),this.updateScores(),this.camera.position.z=10,this.camera.position.y=0,this.camera.rotation.z=0,this.balls=[],this.bricks=[],this.intervals=[],t){const r=new Qt;this.effects=r,r.init(this),this.modifiers=new wt,this.ui={bs:document.getElementById("bs"),bstext:document.querySelector("#bs .text")}}let e=new Rt(this);e.init(),this.padel=e;const s=new N(this);s.init(),this.balls=[s],this.overlay=new Ct(this),this.overlay.init(),this.bricks=[],this.points_record=0,this.hits=0,this.hits_last=0,this.hits_rate=0;const i=6,o=10,n=[1,1,1,1,2,2,2,3,3,4,4];for(let r=0;r<i;r++)for(let h=0;h<o;h++){const v=new Et(this,n,i,o,r,h);v.init(),this.bricks.push(v)}this.scene.background=new c("pink"),t&&this.tick()}updateScores(){document.getElementById("last_score").innerText=this.points_record,document.getElementById("score").innerText=this.points}hitsFloor(t){return t.mesh.position.y<-m/2+10}updateBs(t,e){var s=this.modifiers.getBloodSugar(t);this.ui.bstext.innerText=s.toFixed(1),e?(this.overlay.show(),this.ui.bs.classList.add("low")):(this.overlay.hide(),this.ui.bs.classList.remove("low")),this.modifiers.isBloodSugarNormal()?this.ui.bs.classList.add("normal"):this.ui.bs.classList.remove("normal"),this.modifiers.isBloodSugarHigh()?this.ui.bs.classList.add("high"):this.ui.bs.classList.remove("high")}hitBrick(t,e,s){var i=t.hit(1);if((i==null?void 0:i.ability)=="bomb-column")this.bricks.forEach(o=>{if(o.column==t.column){const n=10;this.hitBrick(o,n,s)}});else if((i==null?void 0:i.ability)=="extra-ball"){const o=new N(this);o.init(),s.push(o)}(i==null?void 0:i.points)>0&&(this.hits++,this.intervals.push(setTimeout(()=>{t&&t.revive()},3e4)),this.points+=i.points,this.shake2=!0,l.fromTo(this,{shake2:!0},{shake2:!1,duration:.2})),document.getElementById("score").innerText=this.points}ballUpdate(t,e,s){if(t.update(e),this.hitsFloor(t))return t.dispose(),!1;this.isBallAlignedWithPaddle(t)&&t.vel.y<0&&(t.setCurve(this.padel.vel.x),this.padel.vel.x<0&&t.vel.x>0||this.padel.vel.x>0&&t.vel.x<0?t.vel.negate():t.vel.reflect(new p(0,1,0)),this.padel.hit(),t.bounce());let i=this.isBallAlignedWithBrick(t);return i&&(t.hitBrick(i),t.vel.reflect(new p(0,1,0)),this.hitBrick(i,t.power,s)),!0}update(t){let e=this.clock.elapsedTime;this.modifiers.update(e);const s=this.modifiers.isBloodSugarLow();this.updateBs(e,s),this.overlay.update(e),e%2==0&&(this.hits_rate=Math.max(1,this.hits-this.hits_last)),this.padel.update(e,s);let i=[];this.balls=this.balls.filter(o=>this.ballUpdate(o,e,i)),this.balls=this.balls.concat(i),this.balls.length==0&&this.die(),this.bricks.forEach(o=>{o.update(e)}),this.shake?this.camera.rotation.z=Math.sin(e*100)*.02:this.shake2?this.camera.rotation.z=Math.sin(e*100)*.005:this.camera.rotation.z=0}reset(){this.intervals.forEach(t=>clearInterval(t)),this.balls.forEach(t=>t.dispose()),this.balls=[],this.bricks.forEach(t=>t.dispose()),this.bricks=[],this.overlay=this.overlay.dispose(),this.padel=this.padel.dispose(),this.renderer.renderLists.dispose(),this.renderer.dispose()}die(){const t=this.points;t>this.points_record&&(console.log("score",t,this.points_record),this.points_record=t,localStorage.setItem("points_record",this.points_record),this.updateScores()),this.clock=new W,document.getElementById("game_over").classList.remove("hidden"),this.points=0,this.updateScores()}isBallAlignedWithPaddle(t){const e=t.mesh.position.x,s=this.padel.mesh.position.x,i=this.padel.mesh.geometry.parameters.width/2,o=t.mesh.position.y,n=this.padel.mesh.position.y,r=this.padel.mesh.geometry.parameters.height/2,h=this.padel.mesh.geometry.parameters.height,v=e>s-i-h&&e<s+i+h,S=o<n+r&&o>n;return v&&S}}const jt=new Ut;jt.init(!0);
//# sourceMappingURL=sugarbreak.a5d5d27f.js.map
